version: '2'

services:
    mysql_db:
        image: mysql
        container_name: 'mysql'
        ports:
          - '3306:3306'
        environment:
          MYSQL_ROOT_PASSWORD: root
          MYSQL_DATABASE: test
          MYSQL_USER: root
          MYSQL_PASSWORD: root
        command: mysqld --character-set-server=utf8 --collation-server=utf8_unicode_ci --skip-character-set-client-handshake

    mongo_db:
        image: mongo
        container_name: 'mongo'
        ports:
          - 27017:27017

    redis_db:
        image: redis
        container_name: 'redis'
        ports:
          - '6379:6379'

    app:
        build: .
        container_name: 'spring-app'
        depends_on:
          - mysql_db
          - mongo_db
          - redis_db
        ports:
          - '8080:8080'
        volumes:
          - .:/spring-boot-bestpractice
        environment:
          SPRING_PROFILES_ACTIVE: local
          MYSQL_DB_HOST: mysql_db
          MYSQL_DB_NAME: test
          MYSQL_DB_USER: root
          MYSQL_DB_PASS: root
          REDIS_DB_HOST: redis_db
          REDIS_DB_PORT: 6379
          REDIS_DB_PASS: root

# mysql -h 127.0.0.1 -u root -p < sql/mysql_sample.sql
# ./gradlew build && docker-compose -f docker-compose.local.yml up